{"version":3,"file":"bare.js","sourceRoot":"","sources":["../../src/integrations/bare.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from 'react-native';\nimport Constants from 'expo-constants';\nimport * as Device from 'expo-device';\nimport * as Updates from './Updates';\nimport {\n  setExtras,\n  setTags,\n  getCurrentHub,\n  setTag,\n  addGlobalEventProcessor,\n} from '@sentry/react-native';\nimport { SeverityLevel } from '@sentry/types';\n\nconst DEFAULT_TAGS = [\n  {\n    tagName: 'expoReleaseChannel',\n    manifestName: 'releaseChannel',\n  },\n  {\n    tagName: 'appVersion',\n    manifestName: 'version',\n  },\n  {\n    tagName: 'appPublishedTime',\n    manifestName: 'publishedTime',\n  },\n  {\n    tagName: 'expoSdkVersion',\n    manifestName: 'sdkVersion',\n  },\n];\n\nexport class ExpoBareIntegration {\n  static id = 'ExpoBareIntegration';\n  name = ExpoBareIntegration.id;\n\n  setupOnce() {\n    const manifest = Updates.manifest as any;\n\n    setExtras({\n      manifest,\n      deviceYearClass: Device.deviceYearClass,\n      linkingUri: Constants.linkingUri,\n    });\n\n    setTags({\n      deviceId: Constants.sessionId,\n    });\n\n    if (typeof manifest === 'object') {\n      DEFAULT_TAGS.forEach((tag) => {\n        if (manifest.hasOwnProperty(tag.manifestName)) {\n          setTag(tag.tagName, manifest[tag.manifestName]);\n        }\n      });\n    }\n\n    const defaultHandler = ErrorUtils.getGlobalHandler();\n\n    ErrorUtils.setGlobalHandler((error, isFatal) => {\n      // Updates bundle names are not predictable in advance, so we replace them with the names\n      // Sentry expects to be in the stacktrace.\n      // The name of the sourcemap file in Sentry is different depending on whether it was uploaded\n      // by the upload-sourcemaps script in this package (in which case it will have a revisionId)\n      // or by the default @sentry/react-native script.\n      if (typeof error.stack === 'string') {\n        const sentryFilename = Platform.OS === 'android' ? 'index.android.bundle' : 'main.jsbundle';\n        error.stack = error.stack.replace(\n          /\\/(bundle\\-\\d+|[\\dabcdef]+\\.bundle)/g,\n          `/${sentryFilename}`\n        );\n      }\n\n      getCurrentHub().withScope((scope) => {\n        if (isFatal) {\n          scope.setLevel('fatal' as SeverityLevel);\n        }\n        getCurrentHub().captureException(error, {\n          originalException: error,\n        });\n      });\n\n      const client = getCurrentHub().getClient();\n      // If in dev, we call the default handler anyway and hope the error will be sent\n      // Just for a better dev experience\n      if (client && !__DEV__) {\n        client.flush(client.getOptions().shutdownTimeout || 2000).then(() => {\n          defaultHandler(error, isFatal);\n        });\n      } else {\n        // If there is no client, something is fishy but we call the default handler anyway. Even if in dev\n        defaultHandler(error, isFatal);\n      }\n    });\n\n    addGlobalEventProcessor(function (event, _hint) {\n      const that = getCurrentHub().getIntegration(ExpoBareIntegration);\n\n      if (that) {\n        event.contexts = {\n          ...(event.contexts || {}),\n          device: {\n            simulator: !Device.isDevice,\n            model: Device.modelName || undefined,\n          },\n          os: {\n            name: Device.osName || undefined,\n            version: Device.osVersion || undefined,\n          },\n        };\n      }\n\n      return event;\n    });\n  }\n}\n"]}